'use strict';var _createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,'value'in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();Object.defineProperty(exports,'__esModule',{value:!0});function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}var Sparga=function(){function a(){_classCallCheck(this,a)}return _createClass(a,[{key:'init',value:function init(a){'string'==typeof a&&(a={gaSettings:{trackingId:a}});var b=a,c=b.autoCaptureClickEvents,d=b.dimensionMap,e=void 0===d?{}:d,f=b.metricMap,g=void 0===f?{}:f,h=b.trackerMap,i=a,j=i.gaSettings;if('string'==typeof j?j={trackingId:j}:!!!j&&j.constructor===Object&&(j=null),(!j||'string'!=typeof j.trackingId)&&(!h||!this.__isPlainObject(h)))throw new Error('Sparga must be initialized with options.gaSettings either being a literal object or a string containing a GA tracking ID (e.g. "UA-XXXX-Y..."), OR a map of trackers must be provided using options.trackerMap. Refer to the Readme.md file for more information.');if(j=Object.assign({},{allowAnchor:!1,alwaysSendReferrer:!0,forceSSL:!0,cookieDomain:'auto',siteSpeedSampleRate:100,storeGac:!1},j),delete j.name,this.trackerMap=h,this.dimensionMap=e,this.metricMap=g,this.__initExceptionListener(),this.__initClickListener(void 0!==c&&c),'undefined'==typeof window)throw new Error('Sparga is intended for browser environments only.');else if(!window.ga){if(this.__initGa(),this.trackerMap){var n=/^[a-z0-9]+$/i,o=j,p=o.cookieDomain;j.trackingId&&console.warn('The options.gaSettings.trackingId was supplied in addition to options.trackerMap; Sparga will only use the trackerMap and will ignore the gaSettings.trackingId.'),delete j.trackingId,delete j.name;var q=Object.keys(this.trackerMap),r=!0,s=!1,t=void 0;try{for(var k,l,m=q[Symbol.iterator]();!(r=(k=m.next()).done);r=!0)if(l=k.value,n.test(l)){var u=this.trackerMap[l];window.ga('create',u,p,l,j)}else throw new Error('The tracker name "'+l+'" is invalid. Only alphanumeric characters are allowed with no spaces.')}catch(a){s=!0,t=a}finally{try{!r&&m.return&&m.return()}finally{if(s)throw t}}}else window.ga('create',j);this.__initHistoryListener()}}},{key:'send',value:function send(){this.__send(arguments)}},{key:'sendEvent',value:function sendEvent(a,b,c,d,e){var f=parseInt(d),g={hitType:'event',eventCategory:a,eventAction:b,eventLabel:c,eventValue:isNaN(f)?void 0:f};this.__send(g,e)}},{key:'sendException',value:function sendException(a,b,c){this.__send({hitType:'exception',exDescription:a,exFatal:b},c)}},{key:'sendSocial',value:function sendSocial(a,b,c,d){this.__send({hitType:'social',socialNetwork:a,socialAction:b,socialTarget:c},d)}},{key:'sendTiming',value:function sendTiming(a,b,c,d,e,f){var g,h=!1;if(!f&&e instanceof Array&&(f=e,e=null),d instanceof Date?(e=e instanceof Date?e:new Date,g=e.getTime()-d.getTime()):g=parseInt(d),g){var i={hitType:'timing',timingCategory:a,timingVar:b,timingValue:g,timingLabel:c};this.__send(i,f),h=!0}else console.warn('A Sparga.sendTiming method call was ignored because neither a valid Date nor a Number was passed into the startOrDuration parameter.');return h}},{key:'setDimension',value:function setDimension(a,b,c){var d=!1;return this.dimensionMap&&this.dimensionMap.hasOwnProperty(a)?(this.__set(this.dimensionMap[a],b,c),d=!0):console.warn('A Sparga.setDimension method call was ignored because the key '+a+' was not found in the provided dimensionMap.'),d}},{key:'setMetric',value:function setMetric(a,b,c){var d=!1;if(this.metricMap&&this.metricMap.hasOwnProperty(a)){var e='number'==typeof b?b:parseFloat(b);isNaN(e)?console.warn('A Sparga.setMetric method call was ignored because the value '+b+' could not be parsed as a valid Number.'):(this.__set(this.metricMap[a],b,c),d=!0)}else console.warn('A Sparga.setMetric method call was ignored because the key '+a+' was not found in the provided metricMap.');return d}},{key:'__initClickListener',value:function __initClickListener(a){var b=this,c=function(a){var c=a.toElement,d=a.x,e=a.y,f=c.id,g=c.className;b.sendEvent('Mouse','Click',JSON.stringify({id:f,className:g,x:d,y:e}))};a?window.document.addEventListener('click',c):window.document.removeEventListener('click',c)}},{key:'__initExceptionListener',value:function __initExceptionListener(){var a=this;window.onerror=function(b,c,d,e){var f='Error: '+b+(c?'\nURL: '+c:'')+(d?'\nLine: '+d:'')+(e?'\nColumn: '+e:'');a.sendException(f)}}},{key:'__initGa',value:function __initGa(){(function(b,c,d,e,f,g,a){b.GoogleAnalyticsObject=f,b[f]=b[f]||function(){(b[f].q=b[f].q||[]).push(arguments)},b[f].l=1*new Date,g=c.createElement(d),a=c.getElementsByTagName(d)[0],g.async=1,g.src=e,a.parentNode.insertBefore(g,a)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga')}},{key:'__initHistoryListener',value:function __initHistoryListener(){var a=this;this.__send({hitType:'pageview',page:location.pathname});var b=history.pushState;history.pushState=function(){b.apply(history,arguments),a.__send({hitType:'pageview',page:location.pathname})}}},{key:'__isPlainObject',value:function __isPlainObject(a){return!!a&&a.constructor==={}.constructor}},{key:'__send',value:function __send(a,b){if(b||this.trackerMap){b=b||Object.keys(this.trackerMap);var c=!0,d=!1,e=void 0;try{for(var f,g,h=b[Symbol.iterator]();!(c=(f=h.next()).done);c=!0)g=f.value,this.trackerMap&&this.trackerMap.hasOwnProperty(g)?window.ga(g+'.send',a):console.warn('A send call was ignored because the provided trackerName '+g+' was not found in the provided trackerMap.')}catch(a){d=!0,e=a}finally{try{!c&&h.return&&h.return()}finally{if(d)throw e}}}else window.ga('send',a)}},{key:'__set',value:function __set(a,b,c){if(c||this.trackerMap){c=c||Object.keys(this.trackerMap);var d=!0,e=!1,f=void 0;try{for(var g,h,i=c[Symbol.iterator]();!(d=(g=i.next()).done);d=!0)h=g.value,this.trackerMap&&this.trackerMap.hasOwnProperty(h)?window.ga(h+'.set',a,b):console.warn('A set call was ignored because the provided trackerName '+h+' was not found in the provided trackerMap.')}catch(a){e=!0,f=a}finally{try{!d&&i.return&&i.return()}finally{if(e)throw f}}}else window.ga('set',a,b)}}]),a}();exports.default=Sparga;
