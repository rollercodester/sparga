'use strict';var _createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,'value'in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();Object.defineProperty(exports,'__esModule',{value:!0});function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}var Sparga=function(){function a(){_classCallCheck(this,a)}return _createClass(a,[{key:'init',value:function init(a){'string'==typeof a&&(a={gaSettings:{trackingId:a}});var b=a,c=b.autoCaptureClickEvents,d=b.dimensionMap,e=void 0===d?{}:d,f=b.metricMap,g=void 0===f?{}:f,h=a,i=h.gaSettings;if('string'==typeof i?i={trackingId:i}:!!!i&&i.constructor===Object&&(i=null),!i||'string'!=typeof i.trackingId)throw new Error('Sparga must be initialized with options.gaSettings either being a literal object or a string containing a GA tracking ID (e.g. "UA-XXXX-Y..."). Refer to the Readme.md file for more information.');if(i=Object.assign({},{allowAnchor:!1,alwaysSendReferrer:!0,forceSSL:!0,cookieDomain:'auto',siteSpeedSampleRate:100,storeGac:!1},i),this.sendCommand=i.name?i.name+'.send':'send',this.setCommand=i.name?i.name+'.set':'set',this.dimensionMap=e,this.metricMap=g,this.__initExceptionListener(),this.__initClickListener(void 0!==c&&c),'undefined'!=typeof window)window.ga||(this.__initGa(),window.ga('create',i),this.__initHistoryListener());else throw new Error('Sparga is intended for browser environments only.')}},{key:'send',value:function send(){window.ga(this.sendCommand,arguments)}},{key:'sendEvent',value:function sendEvent(a,b,c,d){var e=parseInt(d);window.ga(this.sendCommand,{hitType:'event',eventCategory:a,eventAction:b,eventLabel:c,eventValue:isNaN(e)?void 0:e})}},{key:'sendException',value:function sendException(a,b){window.ga(this.sendCommand,{hitType:'exception',exDescription:a,exFatal:b})}},{key:'sendSocial',value:function sendSocial(a,b,c){window.ga(this.sendCommand,{hitType:'social',socialNetwork:a,socialAction:b,socialTarget:c})}},{key:'sendTiming',value:function sendTiming(a,b,c,d,e){var f,g=!1;return d instanceof Date?(e=e instanceof Date?e:new Date,f=e.getTime()-d.getTime()):f=parseInt(d),f?(window.ga(this.sendCommand,{hitType:'timing',timingCategory:a,timingVar:b,timingValue:f,timingLabel:c}),g=!0):console.warn('A Sparga.sendTiming method call was ignored because neither a valid Date nor a Number was passed into the startOrDuration parameter.'),g}},{key:'setDimension',value:function setDimension(a,b){var c=!1;return this.dimensionMap.hasOwnProperty(a)?(window.ga(this.setCommand,this.dimensionMap[a],b),c=!0):console.warn('A Sparga.setDimension method call was ignored because the key '+a+' was not found in the provided dimensionMap.'),c}},{key:'setMetric',value:function setMetric(a,b){var c=!1;if(this.metricMap.hasOwnProperty(a)){var d='number'==typeof b?b:parseFloat(b);isNaN(d)?console.warn('A Sparga.setMetric method call was ignored because the value '+b+' could not be parsed as a valid Number.'):(window.ga(this.setCommand,this.metricMap[a],b),c=!0)}else console.warn('A Sparga.setMetric method call was ignored because the key '+a+' was not found in the provided metricMap.');return c}},{key:'__initClickListener',value:function __initClickListener(a){var b=this,c=function(a){var c=a.toElement,d=a.x,e=a.y,f=c.id,g=c.className;b.sendEvent('Mouse','Click',JSON.stringify({id:f,className:g,x:d,y:e}))};a?window.document.addEventListener('click',c):window.document.removeEventListener('click',c)}},{key:'__initExceptionListener',value:function __initExceptionListener(){var a=this;window.onerror=function(b,c,d,e){var f='Error: '+b+(c?'\nURL: '+c:'')+(d?'\nLine: '+d:'')+(e?'\nColumn: '+e:'');a.sendException(f)}}},{key:'__initGa',value:function __initGa(){(function(b,c,d,e,f,g,a){b.GoogleAnalyticsObject=f,b[f]=b[f]||function(){(b[f].q=b[f].q||[]).push(arguments)},b[f].l=1*new Date,g=c.createElement(d),a=c.getElementsByTagName(d)[0],g.async=1,g.src=e,a.parentNode.insertBefore(g,a)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga')}},{key:'__initHistoryListener',value:function __initHistoryListener(){var a=this;window.ga(this.sendCommand,{hitType:'pageview',page:location.pathname});var b=history.pushState;history.pushState=function(){b.apply(history,arguments),window.ga(a.sendCommand,{hitType:'pageview',page:location.pathname})}}}]),a}();exports.default=Sparga;
